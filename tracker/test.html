<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuckyBet Casino - Geli≈ümi≈ü Test Sitesi</title>
    (function() {
  // Config backend tarafƒ±ndan enjekte edilecek
  const config = __CONFIG__;
  
  if (!config) {
    console.error("TrackLib: Configuration not found");
    return;
  }

  console.log(`TrackLib v3.0 ODIN Edition initialized for ${config.scriptId}`);

  // ============================================
  // CORE VARIABLES
  // ============================================
  const tracker = {};
  let sessionId = getOrCreateSessionId();
  let playerId = null;
  let eventQueue = [];
  let isOnline = navigator.onLine;
  
  // üÜï ADVANCED TRACKING VARIABLES
  let currentFormData = {}; // Ge√ßici form verileri
  let pendingTransactions = new Map(); // Bekleyen i≈ülemler
  let lastKnownBalances = new Map(); // Bakiye takibi
  let depositModalProcessed = new Set(); // ƒ∞≈ülenmi≈ü modal'larƒ± takip et

  // ============================================
  // üí≥ PAYMENT METHOD MAPPING
  // ============================================
  const PAYMENT_METHOD_MAPPING = {
    vevopay: {
      category: '√ñZEL',
      displayName: 'VevoPay',
      type: 'gateway',
      identifiers: ['vevopay', 'vevopay-havale', 'deposit-1548']
    },
    havale_fast: {
      category: 'HAVALE/FAST',
      displayName: 'Havale/EFT/Fast',
      type: 'gateway',
      identifiers: ['havale', 'eft', 'fast', 'bank_transfer', 'banka_havalesi']
    },
    manuel_havale: {
      category: 'MANUEL HAVALE',
      displayName: 'Manuel Havale',
      type: 'manual',
      identifiers: ['manuel', 'manuel_havale', 'manuel_transfer']
    },
    papara: {
      category: 'PAPARA',
      displayName: 'Papara',
      type: 'wallet',
      identifiers: ['papara']
    },
    bitcoin: {
      category: 'KRIPTO',
      displayName: 'Bitcoin',
      type: 'crypto',
      identifiers: ['bitcoin', 'btc']
    },
    ethereum: {
      category: 'KRIPTO',
      displayName: 'Ethereum',
      type: 'crypto',
      identifiers: ['ethereum', 'eth']
    },
    tether: {
      category: 'KRIPTO',
      displayName: 'Tether (USDT)',
      type: 'crypto',
      identifiers: ['tether', 'usdt', 'trc', 'trc20', 'erc20']
    },
    payfix: {
      category: 'SANAL C√úZDAN',
      displayName: 'Payfix',
      type: 'wallet',
      identifiers: ['payfix']
    },
    parazula: {
      category: 'SANAL C√úZDAN',
      displayName: 'Parazula',
      type: 'wallet',
      identifiers: ['parazula']
    },
    mefete: {
      category: 'SANAL C√úZDAN',
      displayName: 'Mefete',
      type: 'wallet',
      identifiers: ['mefete']
    },
    payco: {
      category: 'SANAL C√úZDAN',
      displayName: 'Payco',
      type: 'wallet',
      identifiers: ['payco']
    },
    paypay: {
      category: 'SANAL C√úZDAN',
      displayName: 'PayPay',
      type: 'wallet',
      identifiers: ['paypay']
    },
    qr_code: {
      category: 'QR KOD',
      displayName: 'QR Kod',
      type: 'gateway',
      identifiers: ['qr', 'qr_code', 'qr_kod']
    },
    credit_card: {
      category: 'KREDƒ∞ KARTI',
      displayName: 'Kredi Kartƒ±',
      type: 'gateway',
      identifiers: ['credit_card', 'kredi_karti', 'kredi_kartƒ±', 'visa', 'mastercard', 'bank_card']
    }
  };

  // ============================================
  // üí≥ PAYMENT METHOD DETECTION FUNCTIONS
  // ============================================
  
  /**
   * API endpoint'inden √∂deme y√∂ntemini tespit eder
   */
  function detectPaymentMethodFromAPI(url) {
    if (!url) return null;
    
    const match = url.match(/\/odin\/api\/user\/payment\/([^\/]+)\/(deposit|withdraw)/);
    if (!match) return null;

    const methodName = match[1].toLowerCase().replace(/-/g, '_');
    const action = match[2];

    for (const [key, value] of Object.entries(PAYMENT_METHOD_MAPPING)) {
      if (key === methodName || value.identifiers.some(id => id === methodName)) {
        return { 
          ...value, 
          action, 
          detectedFrom: 'api_endpoint' 
        };
      }
    }

    return {
      category: 'UNKNOWN',
      displayName: methodName,
      type: 'unknown',
      action,
      detectedFrom: 'api_endpoint'
    };
  }

  /**
   * DOM element'inden √∂deme y√∂ntemini tespit eder
   */
  function detectPaymentMethodFromDOM(element) {
    if (!element) return null;

    const classList = (element.className || '').toLowerCase();
    const imgSrc = (element.querySelector('img')?.src || '').toLowerCase();
    const text = (element.textContent || '').toLowerCase();

    for (const [key, value] of Object.entries(PAYMENT_METHOD_MAPPING)) {
      for (const identifier of value.identifiers) {
        const idLower = identifier.toLowerCase();
        if (classList.includes(idLower) || 
            imgSrc.includes(idLower) || 
            text.includes(idLower)) {
          return { 
            ...value, 
            detectedFrom: 'dom_element' 
          };
        }
      }
    }

    return null;
  }

  /**
   * Pop-up HTML i√ßeriƒüinden √∂deme y√∂ntemini tespit eder
   */
  function detectPaymentMethodFromPopup(html) {
    if (!html) return null;
    
    const lowerHTML = html.toLowerCase();

    for (const [key, value] of Object.entries(PAYMENT_METHOD_MAPPING)) {
      for (const identifier of value.identifiers) {
        if (lowerHTML.includes(identifier.toLowerCase())) {
          return { 
            ...value, 
            detectedFrom: 'popup_content' 
          };
        }
      }
    }

    return null;
  }

  // üé∞ TRUVABET GAME TRACKING VARIABLES
  let activeGameSession = null;
  let lastKnownBalance = null;
  let balanceCheckInterval = null;

  // ============================================
  // SESSION MANAGEMENT
  // ============================================
  function getOrCreateSessionId() {
    const key = 'tracklib_session_id';
    let sid = localStorage.getItem(key);
    
    const lastActivity = localStorage.getItem('tracklib_last_activity');
    const now = Date.now();
    
    if (sid && lastActivity && (now - parseInt(lastActivity)) < 30 * 60 * 1000) {
      localStorage.setItem('tracklib_last_activity', now.toString());
      return sid;
    }
    
    sid = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    localStorage.setItem(key, sid);
    localStorage.setItem('tracklib_last_activity', now.toString());
    return sid;
  }

  // ============================================
  // EVENT SENDING WITH RETRY
  // ============================================
  async function sendEvent(eventName, params, retryCount = 0) {
    const payload = {
      api_key: config.apiKey,
      session_id: sessionId,
      player_id: playerId,
      event_name: eventName,
      parameters: {
        ...params,
        page_title: document.title,
        referrer: document.referrer || 'direct',
        screen_resolution: `${screen.width}x${screen.height}`,
        viewport_size: `${window.innerWidth}x${window.innerHeight}`,
        user_agent: navigator.userAgent,
        language: navigator.language,
      },
      url: window.location.href,
      timestamp_utc: new Date().toISOString()
    };

    try {
      const response = await fetch(config.backendUrl, {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'X-Script-Version': '3.0-ODIN'
        },
        body: JSON.stringify(payload),
        keepalive: true
      });

      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }

      console.log(`‚úì TrackLib: ${eventName} sent`, params);
      return true;

    } catch (error) {
      console.error(`‚úó TrackLib: ${eventName} failed:`, error.message);
      
      if (retryCount < 3) {
        const delay = Math.pow(2, retryCount) * 1000;
        setTimeout(() => sendEvent(eventName, params, retryCount + 1), delay);
      } else {
        saveToQueue(eventName, params);
      }
      return false;
    }
  }

  // ============================================
  // OFFLINE QUEUE MANAGEMENT
  // ============================================
  function saveToQueue(eventName, params) {
    try {
      const queue = JSON.parse(localStorage.getItem('tracklib_queue') || '[]');
      queue.push({ eventName, params, timestamp: Date.now() });
      
      if (queue.length > 50) queue.shift();
      
      localStorage.setItem('tracklib_queue', JSON.stringify(queue));
    } catch (e) {
      console.error('TrackLib: Queue save failed', e);
    }
  }

  function processQueue() {
    try {
      const queue = JSON.parse(localStorage.getItem('tracklib_queue') || '[]');
      if (queue.length === 0) return;

      console.log(`TrackLib: Processing ${queue.length} queued events`);
      
      queue.forEach(item => {
        sendEvent(item.eventName, item.params);
      });
      
      localStorage.removeItem('tracklib_queue');
    } catch (e) {
      console.error('TrackLib: Queue process failed', e);
    }
  }
  // ============================================
  // üÜï NETWORK REQUEST INTERCEPTION (ODIN API)
  // ============================================
  function interceptNetworkRequests() {
    // Fetch API interception
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
      const url = args[0];
      const options = args[1] || {};
      
      return originalFetch.apply(this, args).then(response => {
        if (response.ok) {
          response.clone().json().then(data => {
            analyzeNetworkResponse(url, data, options);
          }).catch(() => {});
        }
        return response;
      });
    };

    // XMLHttpRequest interception
    const originalOpen = XMLHttpRequest.prototype.open;
    const originalSend = XMLHttpRequest.prototype.send;

    XMLHttpRequest.prototype.open = function(method, url) {
      this._url = url;
      this._method = method;
      return originalOpen.apply(this, arguments);
    };

    XMLHttpRequest.prototype.send = function() {
      this.addEventListener('load', function() {
        if (this.status >= 200 && this.status < 300) {
          try {
            const data = JSON.parse(this.responseText);
            analyzeNetworkResponse(this._url, data, { method: this._method });
          } catch (e) {}
        }
      });
      return originalSend.apply(this, arguments);
    };
  }
// ============================================
// üéÅ BONUS TRACKING
// ============================================
function analyzeBonusResponse(url, data) {
  if (!url || !data) return;
  
  const urlStr = url.toString().toLowerCase();
  
  // Bonus API: truvabonus-api.gorselpanel.com/api/NewFrames/Index
  if (urlStr.includes('truvabonus-api.gorselpanel.com') || 
      urlStr.includes('/newframes/index')) {
    
    // En son bonus talebi (process)
    if (data.process && data.process.name) {
      const bonus = data.process;
      
      sendEvent('bonus_requested', {
        bonus_id: bonus.id || 0,
        bonus_name: bonus.name,
        request_date: bonus.date,
        status: bonus.status ? 'approved' : 'pending',
        message: bonus.message || 'Beklemede'
      });
      
      console.log(`üéÅ Bonus talebi: ${bonus.name} (${bonus.status ? 'Onaylandƒ±' : 'Beklemede'})`);
    }
    
    // Bonus talep ge√ßmi≈üi analizi
    if (data.requests && Array.isArray(data.requests)) {
      const approvedBonuses = data.requests.filter(r => r.status === true);
      const rejectedBonuses = data.requests.filter(r => r.status === false);
      
      console.log(`üìä Bonus ge√ßmi≈üi: ${approvedBonuses.length} onaylƒ±, ${rejectedBonuses.length} reddedildi`);
    }
  }
}
  function analyzeNetworkResponse(url, data, options = {}) {
    if (!url || !data) return;

    const urlStr = url.toString();
    
    // ‚úÖ PAYMENT METHOD DETECTION
    const paymentInfo = detectPaymentMethodFromAPI(urlStr);
    if (paymentInfo) {
      console.log(`üí≥ API'den √∂deme y√∂ntemi tespit edildi:`, paymentInfo);
    }

    // 1. ODIN Balance API (get_accounts)
    if (urlStr.includes('/odin/api/user/accounts/get_accounts') || 
        urlStr.includes('/get_accounts')) {
      handleOdinBalanceUpdate(data);
    }

    // 2. ODIN Deposit API
    if (urlStr.includes('/odin/api/user/payment/') && urlStr.includes('/deposit')) {
      const amount = data.amount || data.value || null;
      
      if (amount && paymentInfo) {
        const txId = `deposit_${Date.now()}`;
        pendingTransactions.set(txId, {
          type: 'deposit',
          amount: amount,
          method: paymentInfo.displayName,
          category: paymentInfo.category,
          paymentType: paymentInfo.type,
          currency: 'TRY',
          status: 'pending',
          timestamp: Date.now()
        });
        
        sendEvent('deposit_initiated', {
          transaction_id: txId,
          amount: amount,
          payment_method: paymentInfo.displayName,
          payment_category: paymentInfo.category,
          payment_type: paymentInfo.type,
          currency: 'TRY'
        });
      }
    }

    // 3. ODIN Pending Transactions
    if (urlStr.includes('/transaction/getCustomerNewOrPendingTransactions')) {
      handleOdinPendingTransactions(data);
    }

    // 4. ODIN Withdrawal Request
    if (urlStr.includes('/payment/') && urlStr.includes('/withdraw')) {
    console.log('üí∏ Para √ßekme talebi g√∂nderildi');
    
    const withdrawalPaymentInfo = detectPaymentMethodFromAPI(urlStr);
    
    sendEvent('withdrawal_initiated', {
      payment_method: withdrawalPaymentInfo?.displayName || 'unknown',
      payment_category: withdrawalPaymentInfo?.category || 'unknown',
      payment_type: withdrawalPaymentInfo?.type || 'unknown'
    });
  }
  analyzeBonusResponse(url, data);
  }

  window.addEventListener('online', () => {
    isOnline = true;
    console.log('TrackLib: Back online, processing queue');
    processQueue();
  });

  window.addEventListener('offline', () => {
    isOnline = false;
    console.log('TrackLib: Offline mode');
  });

  // ============================================
  // üÜï INPUT FIELD MONITORING
  // ============================================
  function monitorFormInputs() {
    attachInputListeners();

    const observer = new MutationObserver((mutations) => {
      mutations.forEach(mutation => {
        mutation.addedNodes.forEach(node => {
          if (node.nodeType === 1) {
            attachInputListeners(node);
          }
        });
      });
    });

    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
  }

  function attachInputListeners(root = document) {
    const amountInputSelectors = [
      'input[name*="amount"]',
      'input[name*="miktar"]',
      'input[placeholder*="miktar"]',
      'input[placeholder*="amount"]',
      'input[id*="amount"]',
      'input[id="mntNpt"]',
      'input[type="number"]',
      '.amount-input'
    ];

    amountInputSelectors.forEach(selector => {
      const inputs = root.querySelectorAll(selector);
      inputs.forEach(input => {
        if (input.dataset.trackerAttached) return;
        
        input.dataset.trackerAttached = 'true';

        input.addEventListener('blur', (e) => {
          const amount = extractAmountFromInputValue(e.target.value);
          if (amount) {
            currentFormData.amount = amount;
            console.log(`üí∞ Miktar girildi: ${amount} ‚Ç∫`);
          }
        });
      });
    });
  }

  function extractAmountFromInputValue(value) {
    if (!value) return null;
    
    const cleaned = value.replace(/[^\d.,]/g, '');
    
    if (cleaned.includes(',')) {
      return parseFloat(cleaned.replace(/\./g, '').replace(',', '.'));
    } else {
      return parseFloat(cleaned.replace(/,/g, ''));
    }
  }

  // ============================================
  // AMOUNT EXTRACTION HELPER (DOM Config)
  // ============================================
  function extractAmount(selector) {
    if (!selector) return null;

    try {
      const selectors = selector.split(',').map(s => s.trim());
      
      for (const sel of selectors) {
        const element = document.querySelector(sel);
        
        if (!element) continue;

        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA' || element.tagName === 'SELECT') {
          const value = element.value;
          if (value) {
            const amount = parseAmount(value);
            if (amount !== null) return amount;
          }
        }
        
        const text = element.textContent || element.innerText;
        if (text) {
          const amount = parseAmount(text);
          if (amount !== null) return amount;
        }
      }
    } catch (error) {
      console.warn('TrackLib: Amount extraction failed:', error);
    }

    return null;
  }

  function parseAmount(value) {
    if (!value) return null;

    const cleaned = value.toString()
      .replace(/[^\d.,\-]/g, '')
      .replace(',', '.');

    const parsed = parseFloat(cleaned);
    
    return isNaN(parsed) ? null : parsed;
  }

  // ============================================
  // DOM CONFIG RULES SETUP
  // ============================================
  function setupDomTracking() {
    if (!config.domConfig || !config.domConfig.rules || !Array.isArray(config.domConfig.rules)) {
      console.log('TrackLib: No DOM rules configured');
      return;
    }

    config.domConfig.rules.forEach((rule, index) => {
      if (!rule.selector || !rule.eventName || !rule.trigger) {
        console.warn(`TrackLib: Invalid rule at index ${index}:`, rule);
        return;
      }

      try {
        const elements = document.querySelectorAll(rule.selector);
        
        if (elements.length === 0) {
          console.warn(`TrackLib: No elements found for selector: ${rule.selector}`);
          return;
        }

        elements.forEach(element => {
          element.addEventListener(rule.trigger, function(event) {
            console.log(`TrackLib: Event triggered - ${rule.eventName}`, {
              selector: rule.selector,
              trigger: rule.trigger
            });

            let parameters = { ...(rule.parameters || {}) };

            if (rule.extractAmount && rule.amountSelector) {
              const amount = extractAmount(rule.amountSelector);
              
              if (amount !== null) {
                parameters.amount = amount;
                console.log(`TrackLib: Amount extracted - ${amount} from ${rule.amountSelector}`);
              } else {
                console.warn(`TrackLib: Could not extract amount from ${rule.amountSelector}`);
              }
            }

            Object.keys(parameters).forEach(key => {
              const value = parameters[key];
              if (typeof value === 'string' && value.startsWith('data-')) {
                const attrValue = element.getAttribute(value);
                if (attrValue) {
                  parameters[key] = attrValue;
                }
              }
            });

            sendEvent(rule.eventName, parameters);
          });
        });

        console.log(`‚úì TrackLib: Tracking setup for ${rule.eventName} (${elements.length} elements)`);
      } catch (error) {
        console.error(`TrackLib: Error setting up rule ${index}:`, error);
      }
    });
  }
// ============================================
// üéØ TRUVABET PAYMENT METHOD DETECTION
// ============================================
const PAYMENT_METHOD_MAP = {
  'banka_havalesi': 'bank_transfer',
  'bank_transfer': 'bank_transfer',
  'havale': 'bank_transfer',
  'eft': 'bank_transfer',
  
  'bitcoin': 'bitcoin',
  'btc': 'bitcoin',
  
  'kredi_kartƒ±': 'credit_card',
  'credit_card': 'credit_card',
  'visa': 'credit_card',
  'mastercard': 'credit_card',
  
  'mefete': 'mefete',
  'papara': 'papara',
  'parazula': 'parazula',
  'payco': 'payco',
  'payfix': 'payfix',
  'paypay': 'paypay',
  
  'qr_kod': 'qr_code',
  'qr': 'qr_code',
  
  'tether': 'usdt',
  'usdt': 'usdt',
  'trc20': 'trc20',
  'erc20': 'erc20',
  
  'ethereum': 'ethereum',
  'eth': 'ethereum',
  
  'crypto': 'crypto',
  'kripto': 'crypto'
};

function detectPaymentMethod() {
  // 1. Modal i√ßindeki aktif √∂deme y√∂ntemini kontrol et
  const activePaymentTab = document.querySelector('.payment-tab.active, .pymnt-mdl .active');
  if (activePaymentTab) {
    const text = activePaymentTab.textContent.toLowerCase().trim();
    for (const [key, value] of Object.entries(PAYMENT_METHOD_MAP)) {
      if (text.includes(key)) return value;
    }
  }
  
  // 2. URL'den √ßƒ±kar
  const url = window.location.href.toLowerCase();
  for (const [key, value] of Object.entries(PAYMENT_METHOD_MAP)) {
    if (url.includes(key)) return value;
  }
  
  // 3. Son tƒ±klanan payment button'dan
  const lastClickedPayment = document.querySelector('[data-payment-method]');
  if (lastClickedPayment) {
    return lastClickedPayment.dataset.paymentMethod;
  }
  
  return 'unknown';
}

// Deposit initiated event'inde kullan:
sendEvent('deposit_initiated', {
  transaction_id: txId,
  amount: amount,
  currency: 'TRY',
  method: detectPaymentMethod() // ‚úÖ Artƒ±k "unknown" deƒüil, ger√ßek method
});
  // ============================================
  // üÜï ADVANCED DOM LISTENERS
  // ============================================
  function setupAdvancedDOMListeners() {
    document.addEventListener('click', (e) => {
      const target = e.target.closest('button, a, [role="button"]');
      if (!target) return;

      const text = target.textContent.trim();
      const classList = Array.from(target.classList).join(' ');
      
      // Hƒ±zlƒ± tutar butonlarƒ± (100 ‚Ç∫, 250 ‚Ç∫, vb.)
      if (isQuickAmountButton(target, text)) {
        const amount = extractAmountFromButton(text);
        if (amount) {
          currentFormData.amount = amount;
          console.log(`üí∞ Hƒ±zlƒ± tutar se√ßildi: ${amount} ‚Ç∫`);
        }
      }
      
      // "Yatƒ±rƒ±mƒ± Yaptƒ±m" butonu
      else if (isDepositConfirmButton(target, text, classList)) {
        console.log('üí≥ "Yatƒ±rƒ±mƒ± Yaptƒ±m" butonuna tƒ±klandƒ±');
        
        const amount = currentFormData.amount || getAmountFromInput();
        
        if (amount) {
          const txId = `tx_${Date.now()}`;
          
          pendingTransactions.set(txId, {
            type: 'deposit',
            amount: amount,
            timestamp: Date.now(),
            currency: 'TRY',
            method: 'unknown'
          });

          sendEvent('deposit_initiated', {
            transaction_id: txId,
            amount: amount,
            currency: 'TRY',
            method: 'manual'
          });

          console.log(`üìù Bekleyen para yatƒ±rma i≈ülemi: ${txId} - ${amount} ‚Ç∫`);
        }
      }
      
      // "ƒ∞≈ülemi Ba≈ülat" butonu
      else if (isStartTransactionButton(target, text, classList)) {
        console.log('üöÄ "ƒ∞≈ülemi Ba≈ülat" butonuna tƒ±klandƒ±');
        
        const amount = currentFormData.amount || getAmountFromInput();
        
        if (amount) {
          sendEvent('deposit_gateway_initiated', {
            amount: amount,
            method: 'payment_gateway'
          });
        }
      }
      
      // Bakiye yenileme butonu
      else if (isBalanceRefreshButton(target, text, classList)) {
        console.log('üîÑ Bakiye g√ºncelleme butonuna tƒ±klandƒ±');
        
        sendEvent('balance_refresh_clicked', {
          timestamp: Date.now()
        });
      }
    });
  }

  // ============================================
// üéÅ BONUS BUTTON CLICK TRACKING
// ============================================
function setupBonusButtonTracking() {
  document.addEventListener('click', (e) => {
    const target = e.target.closest('button, a, [role="button"]');
    if (!target) return;
    
    const text = target.textContent.trim().toLowerCase();
    
    // "Talep Et" butonu
    if (text.includes('talep et') || text.includes('bonus al')) {
      // Bonus kartƒ±nƒ± bul
      const bonusCard = target.closest('.bonus-card, [class*="bonus"]');
      if (bonusCard) {
        const bonusName = bonusCard.querySelector('h3, h4, .bonus-title, .name')?.textContent?.trim();
        const bonusDesc = bonusCard.querySelector('.description, .desc, p')?.textContent?.trim();
        
        if (bonusName) {
          sendEvent('bonus_claim_clicked', {
            bonus_name: bonusName,
            bonus_description: bonusDesc || 'N/A'
          });
          
          console.log(`üéÅ Bonus talep butonu tƒ±klandƒ±: ${bonusName}`);
        }
      }
    }
  });
}

  // Button detection helpers
  function isQuickAmountButton(button, text) {
    return /\d+\s*‚Ç∫/.test(text) && button.type === 'button';
  }

  function isDepositConfirmButton(button, text, classList) {
    const normalizedText = text.toLowerCase().replace(/\s+/g, '');
    
    return (
      button.type === 'submit' ||
      normalizedText.includes('yatƒ±rƒ±mƒ±yaptƒ±m') ||
      normalizedText.includes('yatƒ±rƒ±myap') ||
      classList.includes('pymnt-frm-btn')
    );
  }

  function isStartTransactionButton(button, text, classList) {
    const normalizedText = text.toLowerCase().replace(/\s+/g, '');
    
    return (
      normalizedText.includes('i≈ülemiba≈ülat') ||
      normalizedText.includes('ba≈ülat') ||
      classList.includes('start-transaction')
    );
  }

  function isBalanceRefreshButton(button, text, classList) {
    const normalizedText = text.toLowerCase().replace(/\s+/g, '');
    
    return (
      normalizedText.includes('bakiye') ||
      normalizedText.includes('g√ºncelle') ||
      normalizedText.includes('refresh') ||
      normalizedText.includes('yenile') ||
      classList.includes('refresh-balance')
    );
  }

  // Amount extraction helpers
  function extractAmountFromButton(text) {
    const match = text.match(/[\d.,]+/);
    if (match) {
      const cleaned = match[0].replace(/\./g, '').replace(',', '.');
      return parseFloat(cleaned);
    }
    return null;
  }

  function getAmountFromInput() {
    const input = document.querySelector('#mntNpt') || 
                 document.querySelector('input[placeholder*="Yatƒ±rƒ±m"]') ||
                 document.querySelector('input[placeholder*="Tutar"]') ||
                 document.querySelector('input[name*="amount"]');
    
    if (input && input.value) {
      return extractAmountFromInputValue(input.value);
    }
    
    return null;
  }

  // ============================================
  // üÜï ODIN BALANCE API HANDLER
  // ============================================
  function handleOdinBalanceUpdate(data) {
    if (!data.success || !Array.isArray(data.data)) return;

    console.log('üîÑ ODIN get_accounts API yanƒ±tƒ± alƒ±ndƒ±');

    data.data.forEach(account => {
      const accountCode = account.accountType?.code;
      if (!accountCode) return;

      const balance = account.balance || 0;
      const lockedBalance = account.lockedBalance || 0;
      const availableBalance = balance - lockedBalance;
      
      // Ana bakiye takibi (Sport Real Balance)
      if (accountCode === 'SRB') {
        const lastBalance = lastKnownBalances.get('SRB') || 0;
        const lastLocked = lastKnownBalances.get('SRB_locked') || 0;

        // Balance deƒüi≈üimi
        if (balance !== lastBalance) {
          const balanceChange = balance - lastBalance;
          lastKnownBalances.set('SRB', balance);
          
          console.log(`üí∞ Sport Real Balance deƒüi≈üti: ${lastBalance} ‚Üí ${balance} (${balanceChange > 0 ? '+' : ''}${balanceChange})`);
          
          // Locked balance yoksa ve balance azaldƒ±ysa -> withdrawal successful
          if (balanceChange < 0 && lockedBalance === 0) {
            matchPendingTransaction(Math.abs(balanceChange), 'withdrawal');
          }
          
          // Locked balance yoksa ve balance arttƒ±ysa -> deposit successful
          if (balanceChange > 0 && lockedBalance === 0) {
            matchPendingTransaction(Math.abs(balanceChange), 'deposit');
          }

          sendEvent('balance_updated', {
            account_type: 'Sport Real Balance',
            previous_balance: lastBalance,
            new_balance: balance,
            change: balanceChange,
            locked_balance: lockedBalance,
            available_balance: availableBalance
          });
        }

        // Locked balance deƒüi≈üimi
        if (lockedBalance !== lastLocked) {
          const lockedChange = lockedBalance - lastLocked;
          lastKnownBalances.set('SRB_locked', lockedBalance);
          
          console.log(`üîí Kilitli bakiye deƒüi≈üti: ${lastLocked} ‚Üí ${lockedBalance} (${lockedChange > 0 ? '+' : ''}${lockedChange})`);
        }
      }
    });
  }

  // ============================================
  // üÜï ODIN PENDING TRANSACTIONS HANDLER
  // ============================================
  function simpleHash(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
      const char = str.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash = hash & hash;
    }
    return hash.toString();
  }

  function handleOdinPendingTransactions(data) {
    if (!data.success || !Array.isArray(data.data)) return;

    data.data.forEach(tx => {
      const txType = tx.transactionType?.code;
      
      // Para yatƒ±rma i≈ülemi
      if (txType === 'D' || txType === 'Deposit') {
        const txId = `odin_${tx.id}`;
        
        if (!pendingTransactions.has(txId)) {
          pendingTransactions.set(txId, {
            type: 'deposit',
            amount: tx.amount,
            currency: tx.transactionCurrency?.currencyCode || 'TRY',
            method: tx.transactionTypeName || 'unknown',
            status: 'pending',
            timestamp: tx.transactionDate
          });

          console.log(`üí≥ Yeni para yatƒ±rma talebi: ${tx.amount} ${tx.transactionCurrency?.currencySymbol}`);
        }
      }
    });
  }

  // ============================================
  // üÜï DEPOSIT SUCCESS MODAL MONITOR (ODIN)
  // ============================================
  function monitorDepositSuccessModal() {
    const observer = new MutationObserver(() => {
      const modal = document.querySelector('#PaymentFormModal.modal.open');
      
      if (modal && 
          modal.style.display === 'block' && 
          modal.style.opacity === '1') {
        
        // Sadece bir kez i≈üle
        const modalContent = modal.innerHTML;
        const modalHash = simpleHash(modalContent);
        
        if (depositModalProcessed.has(modalHash)) return;
        depositModalProcessed.add(modalHash);
        
        // Miktar √ßƒ±kar
        // ‚úÖ YENƒ∞ KOD
        // Miktar √ßƒ±kar
        const amountEl = modal.querySelector('.rslt-mdl h5 > span');
        const amountText = amountEl?.textContent || '';
        const amount = parseFloat(amountText.replace(/[^\d.,]/g, '').replace(',', '.'));
        
        // ‚úÖ √ñDEME Y√ñNTEMƒ∞ TESPƒ∞Tƒ∞ (YENƒ∞ EKLENEN)
        const modalHTML = modal.innerHTML;
        const paymentInfo = detectPaymentMethodFromPopup(modalHTML);
        
        if (amount && amount > 0) {
          if (paymentInfo) {
            console.log(`üí≥ √ñdeme y√∂ntemi: ${paymentInfo.displayName} (${paymentInfo.category})`);
          }
          
          // ‚úÖ Transaction'a payment bilgilerini ekle
          const txId = `deposit_${Date.now()}`;
          pendingTransactions.set(txId, {
            type: 'deposit',
            amount: amount,
            method: paymentInfo?.displayName || 'unknown',
            category: paymentInfo?.category || 'unknown',
            paymentType: paymentInfo?.type || 'unknown',
            status: 'pending',
            timestamp: Date.now()
          });
          
          // ‚úÖ Event'e payment bilgilerini ekle
          sendEvent('deposit_initiated', {
            transaction_id: txId,
            amount: amount,
            payment_method: paymentInfo?.displayName || 'unknown',
            payment_category: paymentInfo?.category || 'unknown',
            payment_type: paymentInfo?.type || 'unknown',
            currency: 'TRY'
          });
          
          console.log(`‚úÖ Deposit success modal detected: ${amount} ‚Ç∫`);
          
          setTimeout(() => {
            depositModalProcessed.delete(modalHash);
          }, 10000);
        }
      }
    });

    observer.observe(document.body, {
      childList: true,
      subtree: true,
      attributes: true,
      attributeFilter: ['style', 'class']
    });
  }

  // ============================================
  // BALANCE & TRANSACTION HANDLERS
  // ============================================
  function handleBalanceUpdate(data) {
    const balance = data.balance || data.amount || data.value;
    
    if (balance !== null && balance !== undefined) {
      const lastBalance = lastKnownBalances.get('generic') || 0;
      lastKnownBalances.set('generic', balance);
      
      const change = balance - lastBalance;
      
      if (change !== 0 && lastBalance > 0) {
        console.log(`üí∞ Balance updated: ${lastBalance} ‚Üí ${balance} (${change > 0 ? '+' : ''}${change})`);

        matchPendingTransaction(Math.abs(change), change > 0 ? 'deposit' : 'withdrawal');

        sendEvent('balance_updated', {
          previous_balance: lastBalance,
          new_balance: balance,
          change: change
        });
      }
    }
  }

  function handleTransactionUpdate(data) {
    if (data.status === 'approved' || data.status === 'confirmed' || data.status === 'success') {
      const amount = data.amount || data.value || null;
      
      if (amount) {
        matchPendingTransaction(amount, 'unknown');
      }
    }
  }

  function matchPendingTransaction(amount, type = 'unknown') {
    let matched = false;

    for (let [txId, tx] of pendingTransactions.entries()) {
      // Tip kontrol√º
      if (type !== 'unknown' && tx.type !== type) continue;

      // Miktar toleransƒ±: 0.1 TL
      const amountMatch = Math.abs(Math.abs(amount) - tx.amount) < 0.1;
      
      if (amountMatch) {
        console.log(`‚úÖ Transaction matched: ${txId}`, tx);
        
        // Ba≈üarƒ±lƒ± event g√∂nder
        if (tx.type === 'deposit') {
          sendEvent('deposit_successful', {
            transaction_id: txId,
            amount: tx.amount,
            currency: tx.currency || 'TRY',
            payment_method: tx.method,
            payment_category: tx.category,        // ‚úÖ EKLE
            payment_type: tx.paymentType,        // ‚úÖ EKLE
            duration_seconds: Math.floor((Date.now() - tx.timestamp) / 1000)
          });
        } else if (tx.type === 'withdrawal') {
          sendEvent('withdrawal_successful', {
            transaction_id: txId,
            amount: tx.amount,
            currency: tx.currency || 'TRY',
            payment_method: tx.method,
            payment_category: tx.category,        // ‚úÖ EKLE
            payment_type: tx.paymentType,        // ‚úÖ EKLE
            duration_seconds: Math.floor((Date.now() - tx.timestamp) / 1000)
          });
        }

        pendingTransactions.delete(txId);
        matched = true;
        break;
      }
    }

    if (!matched && amount > 0) {
      console.warn(`‚ö†Ô∏è  E≈üle≈ütirilemeyen i≈ülem: ${amount} TL (${type})`);
    }
  }

  // ============================================
  // üéÆ TRUVABET GAME TRACKING
  // ============================================

  // BALANCE EXTRACTION - TRUVABET SPECIFIC
  function extractTruvabetBalance() {
    // √ñncelik 1: Header'daki ana bakiye
    const mainBalanceSelectors = [
      '.balance-dropdown-main span[title="Ana Bakiye"] span',
      '.balance-dropdown-main .left > span > span',
    ];
    
    for (const selector of mainBalanceSelectors) {
      const element = document.querySelector(selector);
      if (element) {
        const text = element.textContent || element.innerText;
        const match = text.match(/([\d.,]+)/);
        if (match) {
          const balance = parseFloat(match[1].replace(',', ''));
          if (!isNaN(balance)) {
            return balance;
          }
        }
      }
    }
    
    // √ñncelik 2: Dropdown i√ßindeki "Bakiye"
    const dropdownBalance = document.querySelector('.balance-dropdropdown .blance-text.blc-color:nth-of-type(2) span span');
    if (dropdownBalance) {
      const text = dropdownBalance.textContent || dropdownBalance.innerText;
      const match = text.match(/([\d.,]+)/);
      if (match) {
        const balance = parseFloat(match[1].replace(',', ''));
        if (!isNaN(balance)) {
          return balance;
        }
      }
    }
    
    return null;
  }

  // GAME URL PATTERN DETECTION
  function extractGameInfoFromURL(url) {
    const patterns = [
      {
        regex: /\/games\/detail\/casino\/normal\/(\d+)/,
        type: 'casino'
      },
      {
        regex: /\/games\/livecasino\/detail\/normal\/(\d+)/,
        type: 'live_casino'
      },
      {
        regex: /\/games\/casino\/detail\/normal\/(\d+)/,
        type: 'casino'
      },
      {
        regex: /\/games\/poker/,
        type: 'poker'
      },
      {
        regex: /\/games\/bingo\/(\d+)/,
        type: 'bingo'
      }
    ];
    
    for (const pattern of patterns) {
      const match = url.match(pattern.regex);
      if (match) {
        return {
          gameId: match[1] || 'unknown',
          gameType: pattern.type,
          gameName: extractGameNameFromTitle()
        };
      }
    }
    
    return null;
  }

  function extractGameNameFromTitle() {
    const title = document.title;
    const match = title.match(/^([^|]+)/);
    return match ? match[1].trim() : 'Unknown Game';
  }

  // GAME SESSION HANDLERS
  function handleTruvabetGameStart(gameInfo) {
    if (activeGameSession) {
      handleTruvabetGameEnd();
    }
    
    const balanceBefore = extractTruvabetBalance();
    
    activeGameSession = {
      gameId: gameInfo.gameId,
      gameName: gameInfo.gameName,
      gameType: gameInfo.gameType,
      gameUrl: window.location.href,
      startTime: Date.now(),
      balanceBefore: balanceBefore
    };
    
    sendEvent('game_started', {
      game_id: gameInfo.gameId,
      game_name: gameInfo.gameName,
      game_type: gameInfo.gameType,
      game_url: window.location.href,
      balance_before: balanceBefore,
      currency: 'TRY'
    });
    
    startTruvabetBalanceMonitoring();
    
    console.log(`üéÆ Game started: ${gameInfo.gameName} (Balance: ${balanceBefore} TRY)`);
  }

  function handleTruvabetGameEnd() {
    if (!activeGameSession) return;
    
    stopTruvabetBalanceMonitoring();
    
    const balanceAfter = extractTruvabetBalance();
    const duration = Math.floor((Date.now() - activeGameSession.startTime) / 1000);
    
    let balanceChange = null;
    let result = 'unknown';
    
    if (activeGameSession.balanceBefore !== null && balanceAfter !== null) {
      balanceChange = balanceAfter - activeGameSession.balanceBefore;
      result = balanceChange > 0 ? 'win' : (balanceChange < 0 ? 'loss' : 'neutral');
    }
    
    sendEvent('game_ended', {
      game_id: activeGameSession.gameId,
      game_name: activeGameSession.gameName,
      game_type: activeGameSession.gameType,
      game_url: activeGameSession.gameUrl,
      balance_before: activeGameSession.balanceBefore,
      balance_after: balanceAfter,
      balance_change: balanceChange,
      duration_seconds: duration,
      result: result,
      currency: 'TRY'
    });
    
    console.log(`üèÅ Game ended: ${activeGameSession.gameName} | Duration: ${duration}s | Balance: ${activeGameSession.balanceBefore} ‚Üí ${balanceAfter} (${balanceChange > 0 ? '+' : ''}${balanceChange})`);
    
    activeGameSession = null;
  }

  // BALANCE MONITORING (During Game)
  function startTruvabetBalanceMonitoring() {
    stopTruvabetBalanceMonitoring();
    
    lastKnownBalance = extractTruvabetBalance();
    
    balanceCheckInterval = setInterval(() => {
      const currentBalance = extractTruvabetBalance();
      
      if (currentBalance !== null && lastKnownBalance !== null && currentBalance !== lastKnownBalance) {
        const change = currentBalance - lastKnownBalance;
        
        // Sadece √∂nemli deƒüi≈üimleri logla (10 TL √ºzeri)
        if (Math.abs(change) > 10) {
          sendEvent('in_game_balance_change', {
            game_id: activeGameSession?.gameId,
            game_name: activeGameSession?.gameName,
            balance_before: lastKnownBalance,
            balance_after: currentBalance,
            balance_change: change,
            currency: 'TRY'
          });
        }
        
        lastKnownBalance = currentBalance;
      }
    }, 10000); // Her 10 saniyede bir kontrol
  }

  function stopTruvabetBalanceMonitoring() {
    if (balanceCheckInterval) {
      clearInterval(balanceCheckInterval);
      balanceCheckInterval = null;
    }
  }

  // URL CHANGE DETECTION (SPA Navigation)
  function setupTruvabetGameDetection() {
    let lastUrl = location.href;
    
    // ƒ∞lk y√ºkleme kontrol√º
    const initialGameInfo = extractGameInfoFromURL(lastUrl);
    if (initialGameInfo) {
      setTimeout(() => handleTruvabetGameStart(initialGameInfo), 2000);
    }
    
    // URL deƒüi≈üikliklerini izle
    const urlObserver = new MutationObserver(() => {
      const currentUrl = location.href;
      if (currentUrl !== lastUrl) {
        lastUrl = currentUrl;
        
        const gameInfo = extractGameInfoFromURL(currentUrl);
        
        if (gameInfo) {
          setTimeout(() => handleTruvabetGameStart(gameInfo), 2000);
        } else if (activeGameSession && !currentUrl.includes('/games/')) {
          handleTruvabetGameEnd();
        }
      }
    });
    
    urlObserver.observe(document, { subtree: true, childList: true });
    
    console.log('‚úÖ Truvabet game detection setup complete');
  }

  // BALANCE REFRESH BUTTON TRACKING
  function setupTruvabetBalanceRefreshTracking() {
    const refreshButton = document.querySelector('.refresh-icon');
    if (refreshButton && !refreshButton.dataset.trackerBound) {
      refreshButton.addEventListener('click', () => {
        setTimeout(() => {
          const newBalance = extractTruvabetBalance();
          if (newBalance !== null && newBalance !== lastKnownBalance) {
            sendEvent('balance_refreshed', {
              balance_before: lastKnownBalance,
              balance_after: newBalance,
              balance_change: newBalance - (lastKnownBalance || 0),
              currency: 'TRY',
              triggered_by: 'user_click'
            });
            lastKnownBalance = newBalance;
          }
        }, 1000);
      });
      refreshButton.dataset.trackerBound = 'true';
    }
  }

  // Periyodik olarak refresh butonunu kontrol et
  setInterval(setupTruvabetBalanceRefreshTracking, 3000);

  // IFRAME GAME DETECTION
  function setupTruvabetIframeDetection() {
    const iframeObserver = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        mutation.addedNodes.forEach((node) => {
          if (node.tagName === 'IFRAME') {
            const src = node.src || '';
            
            if (src.includes('game') || src.includes('play') || 
                src.includes('pragmatic') || src.includes('evolution') ||
                src.includes('provider') || src.includes('casino')) {
              
              const currentUrl = window.location.href;
              const gameInfo = extractGameInfoFromURL(currentUrl);
              
              if (gameInfo && !activeGameSession) {
                console.log(`üéÆ Game iframe detected: ${gameInfo.gameName}`);
                handleTruvabetGameStart(gameInfo);
              }
              
              const removalObserver = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                  mutation.removedNodes.forEach((removedNode) => {
                    if (removedNode === node) {
                      console.log(`üèÅ Game iframe removed`);
                      handleTruvabetGameEnd();
                      removalObserver.disconnect();
                    }
                  });
                });
              });
              
              if (node.parentNode) {
                removalObserver.observe(node.parentNode, { childList: true });
              }
            }
          }
        });
      });
    });
    
    iframeObserver.observe(document.body, {
      childList: true,
      subtree: true
    });
  }

  // ============================================
  // PUBLIC API
  // ============================================
  tracker.identify = function(userId) {
    playerId = userId;
    sendEvent('player_identified', { player_id: userId });
  };

  tracker.track = function(eventName, params = {}) {
    if (!config.apiKey) {
      console.error('TrackLib: Not initialized');
      return;
    }
    sendEvent(eventName, params);
  };

  tracker.register = function(userId, email) {
    playerId = userId;
    sendEvent('registration_successful', { player_id: userId, email });
  };

  tracker.login = function(userId) {
    playerId = userId;
    sendEvent('login_successful', { player_id: userId });
  };

  tracker.logout = function() {
    sendEvent('logout', { player_id: playerId });
    playerId = null;
  };

  tracker.deposit = function(amount, currency, method) {
    sendEvent('deposit_successful', {
      amount: parseFloat(amount),
      currency: currency || 'TRY',
      method: method || 'unknown'
    });
  };

  tracker.withdrawal = function(amount, currency, method) {
    sendEvent('withdrawal_successful', {
      amount: parseFloat(amount),
      currency: currency || 'TRY',
      method: method || 'unknown'
    });
  };

  tracker.gameStart = function(gameName) {
    sendEvent('game_started', { game_name: gameName });
  };

  tracker.gameEnd = function(gameName, duration) {
    sendEvent('game_ended', {
      game_name: gameName,
      duration_seconds: duration
    });
  };

  // Debug functions
  tracker.extractAmount = extractAmount;
  tracker.getTruvabetBalance = extractTruvabetBalance;
  tracker.getTruvabetGameSession = () => activeGameSession;
  tracker.endTruvabetGame = handleTruvabetGameEnd;
  
  tracker.getStatus = function() {
    return {
      version: '3.0-ODIN-TRUVABET',
      currentFormData: currentFormData,
      pendingTransactions: Array.from(pendingTransactions.entries()),
      lastBalances: Array.from(lastKnownBalances.entries()),
      sessionId: sessionId,
      playerId: playerId,
      activeGameSession: activeGameSession,
      lastKnownBalance: lastKnownBalance
    };
  };

  tracker.clearPendingTransactions = function() {
    pendingTransactions.clear();
    console.log('üóëÔ∏è T√ºm pending transaction\'lar temizlendi');
  };

  // ============================================
  // AUTO TRACKING
  // ============================================
  window.addEventListener('load', () => {
    sendEvent('page_view', {
      page_path: window.location.pathname,
      page_url: window.location.href
    });
    
    // Initialize all tracking features
    interceptNetworkRequests();
    setupDomTracking();
    setupAdvancedDOMListeners();
    monitorFormInputs();
    monitorDepositSuccessModal();
    setupBonusButtonTracking(); 
    
    // üéÆ Initialize Truvabet game tracking
    setupTruvabetGameDetection();
    setupTruvabetIframeDetection();
    setupTruvabetBalanceRefreshTracking();
    
    processQueue();
  });

  let sessionStartTime = Date.now();
  window.addEventListener('beforeunload', () => {
    const sessionDuration = Math.floor((Date.now() - sessionStartTime) / 1000);
    
    // Aktif oyun varsa kapat
    if (activeGameSession) {
      handleTruvabetGameEnd();
    }
    
    sendEvent('session_end', { duration_seconds: sessionDuration });
  });

  // Expose to window
  window.TrackLib = tracker;
  window.tracker = tracker;
  
  // Debug commands
  window.getTrackerStatus = () => tracker.getStatus();
  window.clearPendingTx = () => tracker.clearPendingTransactions();
  window.getCurrentFormData = () => currentFormData;
  
  console.log('‚úì TrackLib v3.0 ODIN-TRUVABET Edition initialized successfully');
  console.log('‚úì Available as: window.TrackLib and window.tracker');
  console.log('‚úì Features: ODIN API, Deposit Modal, Withdrawal, Balance Tracking, Game Tracking');
  console.log('‚úì Game Tracking: Truvabet-specific (NO provider API interception)');
  console.log('‚úì Debug: window.getTrackerStatus() | window.clearPendingTx()');
})();
    
    <script>
        // Initialize tracker immediately (not in IIFE to avoid scope issues)
        console.log('üöÄ Tracker script y√ºkleniyor...');
        
        window.tracker = {
            currentUserId: null,
            events: [],
            userProfiles: {},
                
                identify: function(userId) {
                    console.log('üìù Tracker.identify √ßaƒürƒ±ldƒ±:', userId);
                    this.currentUserId = userId;
                    
                    if (!this.userProfiles[userId]) {
                        this.userProfiles[userId] = {
                            userId: userId,
                            events: [],
                            createdAt: new Date().toISOString(),
                            totalDeposit: 0,
                            totalWithdrawal: 0,
                            totalGames: 0
                        };
                    }
                    
                    console.log('‚úÖ Kullanƒ±cƒ± tanƒ±mlandƒ±:', userId);
                    return this.userProfiles[userId];
                },
                
                track: function(eventName, properties) {
                    console.log('üìä Tracker.track √ßaƒürƒ±ldƒ±:', eventName, properties);
                    
                    const event = {
                        eventName: eventName,
                        properties: properties || {},
                        userId: this.currentUserId,
                        timestamp: new Date().toISOString()
                    };
                    
                    // Global events listesine ekle
                    this.events.push(event);
                    
                    // Kullanƒ±cƒ± profiline ekle ve analiz et
                    if (this.currentUserId && this.userProfiles[this.currentUserId]) {
                        const profile = this.userProfiles[this.currentUserId];
                        profile.events.push(event);
                        
                        // Event bazlƒ± profil g√ºncellemeleri
                        switch(eventName) {
                            case 'deposit_successful':
                                profile.totalDeposit = (profile.totalDeposit || 0) + (properties.amount || 0);
                                profile.lastDepositAmount = properties.amount;
                                profile.lastDepositMethod = properties.payment_method;
                                profile.lastDepositDate = event.timestamp;
                                break;
                            case 'withdrawal_successful':
                                profile.totalWithdrawal = (profile.totalWithdrawal || 0) + (properties.amount || 0);
                                profile.lastWithdrawalAmount = properties.amount;
                                profile.lastWithdrawalMethod = properties.payment_method;
                                profile.lastWithdrawalDate = event.timestamp;
                                break;
                            case 'game_started':
                                profile.totalGames = (profile.totalGames || 0) + 1;
                                break;
                            case 'bonus_requested':
                                profile.totalBonuses = (profile.totalBonuses || 0) + 1;
                                profile.lastBonusType = properties.bonus_type;
                                profile.lastBonusAmount = properties.bonus_amount;
                                break;
                        }
                        
                        console.log('üë§ Kullanƒ±cƒ± profili g√ºncellendi:', profile);
                    }
                    
                    console.log('‚úÖ Event kaydedildi:', event);
                    console.log('üì¶ Toplam event sayƒ±sƒ±:', this.events.length);
                },
                
                getProfile: function(userId) {
                    return this.userProfiles[userId || this.currentUserId];
                },
                
                getAllEvents: function() {
                    return this.events;
                },
                
                getUserEvents: function(userId) {
                    const profile = this.getProfile(userId);
                    return profile ? profile.events : [];
                },
                
                reset: function() {
                    this.currentUserId = null;
                    this.events = [];
                    this.userProfiles = {};
                    console.log('üîÑ Tracker sƒ±fƒ±rlandƒ±');
                }
            };
            
            console.log('‚úÖ Tracker ba≈üarƒ±yla y√ºklendi!');
            console.log('üìã window.tracker objesi hazƒ±r');
            console.log('üí° Kullanƒ±m: window.tracker.identify("user123")');
            console.log('üí° Kullanƒ±m: window.tracker.track("event_name", {data: "value"})');
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px 0;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .user-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .balance {
            background: rgba(255, 215, 0, 0.2);
            padding: 10px 20px;
            border-radius: 25px;
            border: 2px solid #ffd700;
            font-weight: bold;
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: #333;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: #333;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn.hidden {
            display: none;
        }

        /* Main Content */
        main {
            margin-top: 30px;
        }

        .section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #ffd700;
        }

        /* Login/Register Section */
        .auth-section {
            display: none;
        }

        .auth-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .form-group select option {
            background: #764ba2;
            color: white;
        }

        /* Payment Methods Section */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .payment-method {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .payment-method:hover {
            border-color: #ffd700;
            transform: scale(1.05);
        }

        .payment-method.selected {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
        }

        .payment-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .payment-name {
            font-size: 14px;
            font-weight: bold;
        }

        /* Bonus Section */
        .bonus-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .bonus-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            transition: all 0.3s;
        }

        .bonus-card:hover {
            border-color: #ffd700;
            transform: translateY(-5px);
        }

        .bonus-icon {
            font-size: 50px;
            margin-bottom: 15px;
        }

        .bonus-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffd700;
        }

        .bonus-description {
            font-size: 14px;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.8);
        }

        .bonus-amount {
            font-size: 24px;
            font-weight: bold;
            color: #00ff00;
            margin-bottom: 15px;
        }

        /* Games Grid */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .game-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .game-card:hover {
            transform: scale(1.05);
            border-color: #ffd700;
        }

        .game-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .game-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .game-provider {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 30px;
            cursor: pointer;
            color: white;
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #ffd700;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Action Buttons Grid */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-weight: bold;
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 2000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Test Controls Panel */
        .test-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #ffd700;
            max-width: 300px;
        }

        .test-controls h3 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .test-controls button {
            width: 100%;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="notification" class="notification"></div>

    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">üé∞ LuckyBet Casino</div>
                <div class="user-info">
                    <div class="balance" id="balance">Bakiye: ‚Ç∫0</div>
                    <button class="btn btn-primary" id="loginBtn">Giri≈ü Yap</button>
                    <button class="btn btn-danger hidden" id="logoutBtn">√áƒ±kƒ±≈ü</button>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Auth Section -->
        <div id="authSection" class="auth-section active">
            <div class="section">
                <h2 class="section-title">üîê Giri≈ü Yap / Kayƒ±t Ol</h2>
                <div class="form-group">
                    <label>Kullanƒ±cƒ± Adƒ± / Email</label>
                    <input type="text" id="username" placeholder="Kullanƒ±cƒ± adƒ±nƒ±zƒ± girin">
                </div>
                <div class="form-group">
                    <label>≈ûifre</label>
                    <input type="password" id="password" placeholder="≈ûifrenizi girin">
                </div>
                <button class="btn btn-success" onclick="handleLogin()">üéØ Hemen Ba≈üla</button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="dashboard">
            <!-- Stats -->
            <div class="section">
                <h2 class="section-title">üìä ƒ∞statistikler</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">üí∞ Toplam Yatƒ±rƒ±m</div>
                        <div class="stat-value" id="totalDeposit">‚Ç∫0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üí∏ Toplam √áekim</div>
                        <div class="stat-value" id="totalWithdrawal">‚Ç∫0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üéÆ Oynanan Oyun</div>
                        <div class="stat-value" id="gamesPlayed">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üéÅ Alƒ±nan Bonus</div>
                        <div class="stat-value" id="totalBonuses">0</div>
                    </div>
                </div>
            </div>

            <!-- Bonuses -->
            <div class="section">
                <h2 class="section-title">üéÅ Bonus Fƒ±rsatlarƒ±</h2>
                <div class="bonus-cards">
                    <div class="bonus-card">
                        <div class="bonus-icon">üéâ</div>
                        <div class="bonus-title">Ho≈ü Geldin Bonusu</div>
                        <div class="bonus-description">ƒ∞lk √ºyeliƒüe √∂zel %100 bonus</div>
                        <div class="bonus-amount">‚Ç∫500</div>
                        <button class="btn btn-warning" onclick="requestBonus('welcome_bonus', 500, '100% ƒ∞lk Yatƒ±rƒ±m Bonusu')">Talep Et</button>
                    </div>
                    <div class="bonus-card">
                        <div class="bonus-icon">üîÑ</div>
                        <div class="bonus-title">Kayƒ±p Bonusu</div>
                        <div class="bonus-description">Kayƒ±plarƒ±nƒ±n %10'u geri</div>
                        <div class="bonus-amount">%10</div>
                        <button class="btn btn-warning" onclick="requestBonus('cashback_bonus', 100, 'Haftalƒ±k Kayƒ±p Bonusu')">Talep Et</button>
                    </div>
                    <div class="bonus-card">
                        <div class="bonus-icon">üé∞</div>
                        <div class="bonus-title">Bedava Spin</div>
                        <div class="bonus-description">50 adet bedava √ßevirme</div>
                        <div class="bonus-amount">50 Spin</div>
                        <button class="btn btn-warning" onclick="requestBonus('free_spins', 50, '50 Bedava Spin')">Talep Et</button>
                    </div>
                    <div class="bonus-card">
                        <div class="bonus-icon">üíé</div>
                        <div class="bonus-title">VIP Bonus</div>
                        <div class="bonus-description">Sadakat programƒ± bonusu</div>
                        <div class="bonus-amount">‚Ç∫1000</div>
                        <button class="btn btn-warning" onclick="requestBonus('loyalty_bonus', 1000, 'VIP Sadakat Bonusu')">Talep Et</button>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="section">
                <h2 class="section-title">‚ö° Hƒ±zlƒ± ƒ∞≈ülemler</h2>
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="openDepositModal()">üí∞ Para Yatƒ±r</button>
                    <button class="btn btn-info" onclick="openWithdrawModal()">üí∏ Para √áek</button>
                    <button class="btn btn-warning" onclick="simulateDepositFailed()">‚ùå Ba≈üarƒ±sƒ±z Yatƒ±rƒ±m (Test)</button>
                    <button class="btn btn-danger" onclick="handleWithdrawalFailed()">‚ùå Ba≈üarƒ±sƒ±z √áekim (Test)</button>
                </div>
            </div>

            <!-- Games -->
            <div class="section">
                <h2 class="section-title">üéÆ Pop√ºler Oyunlar</h2>
                <div class="games-grid">
                    <div class="game-card" onclick="playGame('Sweet Bonanza', 'sweet_bonanza')">
                        <div class="game-icon">üç¨</div>
                        <div class="game-title">Sweet Bonanza</div>
                        <div class="game-provider">Pragmatic Play</div>
                    </div>
                    <div class="game-card" onclick="playGame('Gates of Olympus', 'gates_olympus')">
                        <div class="game-icon">‚ö°</div>
                        <div class="game-title">Gates of Olympus</div>
                        <div class="game-provider">Pragmatic Play</div>
                    </div>
                    <div class="game-card" onclick="playGame('Mega Moolah', 'mega_moolah')">
                        <div class="game-icon">ü¶Å</div>
                        <div class="game-title">Mega Moolah</div>
                        <div class="game-provider">Microgaming</div>
                    </div>
                    <div class="game-card" onclick="playGame('Book of Dead', 'book_of_dead')">
                        <div class="game-icon">üìö</div>
                        <div class="game-title">Book of Dead</div>
                        <div class="game-provider">Play'n GO</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Deposit Modal -->
    <div id="depositModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeDepositModal()">√ó</span>
            <h2 class="section-title">üí∞ Para Yatƒ±r</h2>
            
            <div class="form-group">
                <label>Miktar (TRY)</label>
                <input type="number" id="depositAmount" placeholder="Yatƒ±rmak istediƒüiniz tutarƒ± girin" min="10" value="100">
            </div>

            <h3 style="margin: 20px 0; color: #ffd700;">√ñdeme Y√∂ntemi Se√ßin:</h3>
            <div class="payment-methods">
                <div class="payment-method" data-method="credit_card" onclick="selectPaymentMethod('credit_card', 'Kredi Kartƒ±')">
                    <div class="payment-icon">üí≥</div>
                    <div class="payment-name">Kredi Kartƒ±</div>
                </div>
                <div class="payment-method" data-method="bank_transfer" onclick="selectPaymentMethod('bank_transfer', 'Banka Transferi')">
                    <div class="payment-icon">üè¶</div>
                    <div class="payment-name">Banka Transferi</div>
                </div>
                <div class="payment-method" data-method="papara" onclick="selectPaymentMethod('papara', 'Papara')">
                    <div class="payment-icon">üì±</div>
                    <div class="payment-name">Papara</div>
                </div>
                <div class="payment-method" data-method="paykasa" onclick="selectPaymentMethod('paykasa', 'PayKasa')">
                    <div class="payment-icon">üé´</div>
                    <div class="payment-name">PayKasa</div>
                </div>
                <div class="payment-method" data-method="cmt" onclick="selectPaymentMethod('cmt', 'CMT')">
                    <div class="payment-icon">üí∞</div>
                    <div class="payment-name">CMT</div>
                </div>
                <div class="payment-method" data-method="crypto" onclick="selectPaymentMethod('crypto', 'Kripto Para')">
                    <div class="payment-icon">‚Çø</div>
                    <div class="payment-name">Kripto</div>
                </div>
                <div class="payment-method" data-method="ewallet" onclick="selectPaymentMethod('ewallet', 'E-C√ºzdan')">
                    <div class="payment-icon">üëõ</div>
                    <div class="payment-name">E-C√ºzdan</div>
                </div>
                <div class="payment-method" data-method="fast_havale" onclick="selectPaymentMethod('fast_havale', 'Fast Havale')">
                    <div class="payment-icon">‚ö°</div>
                    <div class="payment-name">Fast Havale</div>
                </div>
            </div>

            <button class="btn btn-success" style="width: 100%; margin-top: 20px;" onclick="processDeposit()">‚úÖ Yatƒ±rƒ±mƒ± Tamamla</button>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeWithdrawModal()">√ó</span>
            <h2 class="section-title">üí∏ Para √áek</h2>
            
            <div class="form-group">
                <label>Miktar (TRY)</label>
                <input type="number" id="withdrawAmount" placeholder="√áekmek istediƒüiniz tutarƒ± girin" min="50" value="100">
            </div>

            <h3 style="margin: 20px 0; color: #ffd700;">√ñdeme Y√∂ntemi Se√ßin:</h3>
            <div class="payment-methods">
                <div class="payment-method" data-method="bank_transfer" onclick="selectWithdrawMethod('bank_transfer', 'Banka Transferi')">
                    <div class="payment-icon">üè¶</div>
                    <div class="payment-name">Banka Transferi</div>
                </div>
                <div class="payment-method" data-method="papara" onclick="selectWithdrawMethod('papara', 'Papara')">
                    <div class="payment-icon">üì±</div>
                    <div class="payment-name">Papara</div>
                </div>
                <div class="payment-method" data-method="crypto" onclick="selectWithdrawMethod('crypto', 'Kripto Para')">
                    <div class="payment-icon">‚Çø</div>
                    <div class="payment-name">Kripto</div>
                </div>
                <div class="payment-method" data-method="ewallet" onclick="selectWithdrawMethod('ewallet', 'E-C√ºzdan')">
                    <div class="payment-icon">üëõ</div>
                    <div class="payment-name">E-C√ºzdan</div>
                </div>
            </div>

            <div class="action-buttons" style="margin-top: 20px;">
                <button class="btn btn-warning" onclick="requestWithdrawal()">üìù √áekim Talebi Olu≈ütur</button>
                <button class="btn btn-success" onclick="processWithdrawalSuccess()">‚úÖ √áekimi Onayla</button>
            </div>
        </div>
    </div>

    <!-- Game Modal -->
    <div id="gameModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">√ó</span>
            <h2 class="section-title" id="gameTitle">Oyun</h2>
            <p style="text-align: center; font-size: 18px; margin: 30px 0;">üé∞ Oyun oynuyor...</p>
            <div class="action-buttons">
                <button class="btn btn-success" onclick="simulateWin()">üéâ Kazan</button>
                <button class="btn btn-danger" onclick="simulateLoss()">üò¢ Kaybet</button>
            </div>
        </div>
    </div>

    <!-- Test Controls (Debug Panel) -->
    <div class="test-controls">
        <h3>üîß Test Kontrolleri</h3>
        <button class="btn btn-info btn-sm" onclick="checkTracker()">Tracker Durumu</button>
        <button class="btn btn-primary btn-sm" onclick="showConsole()">Console Loglarƒ±</button>
    </div>

    <script>
        // Global deƒüi≈ükenler
        window.currentBalance = 0;
        window.totalDeposit = 0;
        window.totalWithdrawal = 0;
        window.gamesPlayed = 0;
        window.totalBonuses = 0;
        window.currentGameId = null;
        window.selectedPaymentMethod = null;
        window.selectedPaymentMethodName = null;
        window.selectedWithdrawMethod = null;
        window.selectedWithdrawMethodName = null;
        window.currentPlayerId = null;

        // Login Handler
        window.handleLogin = function() {
            const username = document.getElementById('username').value || 'test_user_' + Date.now();
            const email = username.includes('@') ? username : undefined;
            const playerId = username;
            window.currentPlayerId = playerId;

            console.log('=== LOGIN STARTED ===');
            console.log('Player ID:', playerId);
            console.log('Tracker available:', !!window.tracker);
            
            // Tracker'a kimlik bildir
            if (window.tracker) {
                console.log('Calling tracker.identify with:', playerId);
                window.tracker.identify(playerId);
                
                // Login eventi g√∂nder
                console.log('Calling tracker.track login_successful');
                window.tracker.track('login_successful', {
                    email: email || undefined
                });
            } else {
                console.error('window.tracker not available!');
            }

            // UI g√ºncelle
            document.getElementById('authSection').classList.remove('active');
            document.getElementById('dashboard').classList.add('active');
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('logoutBtn').classList.remove('hidden');
            
            window.currentBalance = 1000; // Ba≈ülangƒ±√ß bakiyesi
            updateBalance();

            showNotification(`‚úÖ Ho≈ü geldin ${playerId}!`, 'success');
        };

        // Payment Method Selection for Deposit
        window.selectPaymentMethod = function(method, name) {
            window.selectedPaymentMethod = method;
            window.selectedPaymentMethodName = name;
            
            // Remove all selected classes
            document.querySelectorAll('#depositModal .payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Add selected class to clicked element
            event.target.closest('.payment-method').classList.add('selected');
            
            console.log('Deposit payment method selected:', method, name);
        };

        // Payment Method Selection for Withdrawal
        window.selectWithdrawMethod = function(method, name) {
            window.selectedWithdrawMethod = method;
            window.selectedWithdrawMethodName = name;
            
            // Remove all selected classes
            document.querySelectorAll('#withdrawModal .payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Add selected class to clicked element
            event.target.closest('.payment-method').classList.add('selected');
            
            console.log('Withdraw payment method selected:', method, name);
        };

        // Open Deposit Modal
        window.openDepositModal = function() {
            document.getElementById('depositModal').classList.add('active');
        };

        // Close Deposit Modal
        window.closeDepositModal = function() {
            document.getElementById('depositModal').classList.remove('active');
        };

        // Process Deposit
        window.processDeposit = function() {
            const amount = parseInt(document.getElementById('depositAmount').value);
            
            if (!amount || amount < 10) {
                showNotification('‚ùå Ge√ßersiz tutar! Minimum 10 TL', 'error');
                return;
            }

            if (!window.selectedPaymentMethod) {
                showNotification('‚ùå L√ºtfen bir √∂deme y√∂ntemi se√ßin!', 'error');
                return;
            }

            console.log('=== PROCESSING DEPOSIT ===');
            console.log('Amount:', amount);
            console.log('Payment Method:', window.selectedPaymentMethod, window.selectedPaymentMethodName);
            
            window.currentBalance += amount;
            window.totalDeposit += amount;
            updateBalance();
            updateStats();

            if (window.tracker) {
                console.log('Sending deposit_successful with payment method:', window.selectedPaymentMethod);
                window.tracker.track('deposit_successful', {
                    amount: amount,
                    currency: 'TRY',
                    payment_method: window.selectedPaymentMethod,
                    payment_method_name: window.selectedPaymentMethodName
                });
            }

            showNotification(`‚úÖ ${amount} TL ${window.selectedPaymentMethodName} ile yatƒ±rƒ±ldƒ±!`, 'success');
            closeDepositModal();
            
            // Reset selection
            window.selectedPaymentMethod = null;
            window.selectedPaymentMethodName = null;
        };

        // Simulate Failed Deposit
        window.simulateDepositFailed = function() {
            const amount = 100 + Math.floor(Math.random() * 400);
            
            console.log('=== SIMULATING FAILED DEPOSIT ===');
            console.log('Amount:', amount);

            if (window.tracker) {
                window.tracker.track('deposit_failed', {
                    amount: amount,
                    currency: 'TRY',
                    payment_method: 'credit_card',
                    error_code: 'insufficient_funds',
                    error_message: 'Yetersiz bakiye'
                });
            }

            showNotification(`‚ùå ${amount} TL yatƒ±rƒ±m ba≈üarƒ±sƒ±z! (Yetersiz bakiye)`, 'error');
        };

        // Open Withdraw Modal
        window.openWithdrawModal = function() {
            document.getElementById('withdrawModal').classList.add('active');
        };

        // Close Withdraw Modal
        window.closeWithdrawModal = function() {
            document.getElementById('withdrawModal').classList.remove('active');
        };

        // Request Withdrawal
        window.requestWithdrawal = function() {
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            
            if (!amount || amount < 50) {
                showNotification('‚ùå Ge√ßersiz tutar! Minimum 50 TL', 'error');
                return;
            }

            if (window.currentBalance < amount) {
                showNotification('‚ùå Yetersiz bakiye!', 'error');
                return;
            }

            if (!window.selectedWithdrawMethod) {
                showNotification('‚ùå L√ºtfen bir √∂deme y√∂ntemi se√ßin!', 'error');
                return;
            }

            console.log('=== WITHDRAWAL REQUESTED ===');
            console.log('Amount:', amount);
            console.log('Payment Method:', window.selectedWithdrawMethod, window.selectedWithdrawMethodName);

            if (window.tracker) {
                window.tracker.track('withdrawal_requested', {
                    amount: amount,
                    currency: 'TRY',
                    payment_method: window.selectedWithdrawMethod,
                    payment_method_name: window.selectedWithdrawMethodName
                });
            }

            showNotification(`üí∏ ${amount} TL √ßekim talebi ${window.selectedWithdrawMethodName} i√ßin olu≈üturuldu!`, 'info');
        };

        // Process Withdrawal Success
        window.processWithdrawalSuccess = function() {
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            
            if (!amount || amount < 50) {
                showNotification('‚ùå Ge√ßersiz tutar! Minimum 50 TL', 'error');
                return;
            }

            if (window.currentBalance < amount) {
                showNotification('‚ùå Yetersiz bakiye!', 'error');
                return;
            }

            if (!window.selectedWithdrawMethod) {
                showNotification('‚ùå L√ºtfen bir √∂deme y√∂ntemi se√ßin!', 'error');
                return;
            }

            console.log('=== WITHDRAWAL SUCCESSFUL ===');
            console.log('Amount:', amount);
            console.log('Payment Method:', window.selectedWithdrawMethod, window.selectedWithdrawMethodName);
            
            window.currentBalance -= amount;
            window.totalWithdrawal += amount;
            updateBalance();
            updateStats();

            if (window.tracker) {
                window.tracker.track('withdrawal_successful', {
                    amount: amount,
                    currency: 'TRY',
                    payment_method: window.selectedWithdrawMethod,
                    payment_method_name: window.selectedWithdrawMethodName
                });
            }

            showNotification(`‚úÖ ${amount} TL ${window.selectedWithdrawMethodName} ile √ßekim ba≈üarƒ±lƒ±!`, 'success');
            closeWithdrawModal();
            
            // Reset selection
            window.selectedWithdrawMethod = null;
            window.selectedWithdrawMethodName = null;
        };

        // Withdrawal Failed Handler
        window.handleWithdrawalFailed = function() {
            const amount = Math.floor(Math.random() * 200) + 50;

            console.log('=== WITHDRAWAL FAILED ===');
            console.log('Amount:', amount);

            if (window.tracker) {
                window.tracker.track('withdrawal_failed', {
                    amount: amount,
                    currency: 'TRY',
                    payment_method: 'bank_transfer',
                    error_code: 'bank_rejected',
                    error_message: 'Banka tarafƒ±ndan reddedildi'
                });
            }

            showNotification(`‚ùå ${amount} TL √ßekim ba≈üarƒ±sƒ±z! (Banka reddetti)`, 'error');
        };

        // Request Bonus
        window.requestBonus = function(bonusType, bonusAmount, bonusName) {
            console.log('=== BONUS REQUESTED ===');
            console.log('Bonus Type:', bonusType);
            console.log('Bonus Amount:', bonusAmount);
            console.log('Bonus Name:', bonusName);

            if (window.tracker) {
                window.tracker.track('bonus_requested', {
                    bonus_type: bonusType,
                    bonus_amount: bonusAmount,
                    bonus_name: bonusName,
                    bonus_currency: 'TRY'
                });
            }

            window.totalBonuses++;
            updateStats();

            showNotification(`üéÅ ${bonusName} talebiniz alƒ±ndƒ±! (${bonusAmount})`, 'success');
        };

        // Play Game
        window.playGame = function(gameName, gameId) {
            console.log('=== GAME STARTED ===');
            console.log('Game:', gameName, gameId);
            
            window.currentGameId = gameId;
            document.getElementById('gameTitle').textContent = gameName;
            document.getElementById('gameModal').classList.add('active');

            window.gamesPlayed++;
            updateStats();

            if (window.tracker) {
                window.tracker.track('game_started', {
                    game_id: gameId,
                    game_name: gameName
                });
            }
        };

        // Simulate Win
        window.simulateWin = function() {
            const winAmount = Math.floor(Math.random() * 300) + 50;
            window.currentBalance += winAmount;
            updateBalance();

            if (window.tracker) {
                window.tracker.track('game_ended', {
                    game_id: window.currentGameId,
                    result: 'win',
                    amount: winAmount
                });
            }

            showNotification(`üéâ ${winAmount} TL kazandƒ±nƒ±z!`, 'success');
            closeModal();
        };

        // Simulate Loss
        window.simulateLoss = function() {
            const lossAmount = Math.floor(Math.random() * 100) + 20;
            window.currentBalance = Math.max(0, window.currentBalance - lossAmount);
            updateBalance();

            if (window.tracker) {
                window.tracker.track('game_ended', {
                    game_id: window.currentGameId,
                    result: 'loss',
                    amount: lossAmount
                });
            }

            showNotification(`üò¢ ${lossAmount} TL kaybettiniz`, 'error');
            closeModal();
        };

        // Close Modal
        window.closeModal = function() {
            document.getElementById('gameModal').classList.remove('active');
            window.currentGameId = null;
        };

        // Logout Handler
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (window.tracker) {
                    window.tracker.track('logout');
                }

                document.getElementById('authSection').classList.add('active');
                document.getElementById('dashboard').classList.remove('active');
                document.getElementById('loginBtn').classList.remove('hidden');
                document.getElementById('logoutBtn').classList.add('hidden');

                window.currentBalance = 0;
                window.totalDeposit = 0;
                window.totalWithdrawal = 0;
                window.gamesPlayed = 0;
                window.totalBonuses = 0;
                updateBalance();
                updateStats();

                showNotification('üëã G√∂r√º≈ümek √ºzere!', 'info');
            });

            // Quick login on Enter
            document.getElementById('username').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleLogin();
            });
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleLogin();
            });
        });

        // Update Balance
        function updateBalance() {
            document.getElementById('balance').textContent = `Bakiye: ‚Ç∫${window.currentBalance}`;
        }

        // Update Stats
        function updateStats() {
            document.getElementById('totalDeposit').textContent = `‚Ç∫${window.totalDeposit}`;
            document.getElementById('totalWithdrawal').textContent = `‚Ç∫${window.totalWithdrawal}`;
            document.getElementById('gamesPlayed').textContent = window.gamesPlayed;
            document.getElementById('totalBonuses').textContent = window.totalBonuses;
        }

        // Show Notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Debug Functions
        window.checkTracker = function() {
            console.log('=== TRACKER STATUS ===');
            console.log('Tracker exists:', !!window.tracker);
            console.log('Tracker object:', window.tracker);
            console.log('Current Player ID:', window.currentPlayerId);
            alert('Tracker durumu console\'da g√∂r√ºnt√ºlendi. F12 ile kontrol edin.');
        };

        window.showConsole = function() {
            alert('Console loglarƒ±nƒ± g√∂rmek i√ßin F12 tu≈üuna basƒ±n ve Console sekmesini a√ßƒ±n.');
        };

        // Auto-check tracker on load
        window.addEventListener('load', function() {
            console.log('=== PAGE LOADED ===');
            console.log('Tracker available:', !!window.tracker);
            if (window.tracker) {
                console.log('Tracker loaded successfully!');
            } else {
                console.error('‚ö†Ô∏è Tracker NOT found! Make sure the tracker script is loaded before this page.');
            }
        });
    </script>
</body>
</html>